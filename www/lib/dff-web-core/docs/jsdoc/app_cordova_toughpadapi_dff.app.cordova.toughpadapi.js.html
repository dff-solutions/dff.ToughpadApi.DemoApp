<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: app/cordova/toughpadapi/dff.app.cordova.toughpadapi.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: app/cordova/toughpadapi/dff.app.cordova.toughpadapi.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
/**
 * Packagepay namespace contains all components for using cordova ToughpadApi plugin.
 *
 * @namespace dff/app/cordova/toughpadapi
 *
 */
dff.namespace('dff.app.cordova.toughpadapi');

/**
 * Logs incoming messageges from LApp service.
 *
 * @name IncomingMessageLogger
 * @memberOf dff/app/cordova/toughpadapi
 * @constructor
 *
 * @param {Object} dffLoggingService Instance of dffLoggingService for logging.
 */
dff.define('dff.app.cordova.toughpadapi.BarcodeLogger', function (dffLoggingService) {
    return {
        onRead: function (msg) {
            dffLoggingService.log("toughpadapi - barcode read:", msg);
        }
    };
});

/**
 * Service for interacting with cordova packagepay plugin.
 *
 * @name ToughpadApiService
 * @memberOf dff/app/cordova/toughpadapi
 * @constructor
 *
 * @param {Object} window Window object as closure for Packagepay plugin object.
 * @param {Object} dffLoggingService dffLoggingService for logging.
 * @param {Object} Logtyp Logtype enum.
 * @param {Object[]} barcodeListeners Listeners for barcodes.
 */
dff.define('dff.app.cordova.toughpadapi.ToughpadApiService', function (
    window,
    dffLoggingService,
    Logtype,
    barcodeListeners
) {
    var self = {};

    barcodeListeners = barcodeListeners || [];

    /**
     * Notifies all incoming message listeners with given message.
     *
     * @name notifyBarcodeListener
     * @memberOf dff/app/cordova/toughpadapi.ToughpadApiService
     * @function
     * @instance
     *
     * @param {Object} msg Message to notify listeners with.
     */
    self.notifyBarcodeListener = function (msg) {
        return barcodeListeners
            .reduce(function (prev, cur) {
                return prev
                    .then(function () {
                        return cur.onRead(msg);
                    });
            }, Promise.resolve());
    };

    /**
     * Registers a new listener for incoming messages.
     *
     * @name addBarcodeListener
     * @memberOf dff/app/cordova/toughpadapi.ToughpadApiService
     * @function
     * @instance
     *
     * @param {Object} listener A listener for barcodes.
     *                          Must implement a onRead function.
     */
    self.addBarcodeListener = function (listener) {
        barcodeListeners.push(listener);
    };

    /**
     * Removes a listener for barcodes
     *
     * @name removeBarcodeListener
     * @memberOf dff/app/cordova/toughpadapi.ToughpadApiService
     * @function
     * @instance
     *
     * @param {Object} listener A registered listener for barcodes.
     */
    self.removeBarcodeListener = function (listener) {
        var i = barcodeListeners.indexOf(listener);

        if (i >= 0) {
            barcodeListeners.splice(i, 1);
        }
    };

    /**
     * Starts packagepay service.
     * Registers handler for log events and messages from cordova ToughpadApi plugin.
     *
     * @name startService
     * @memberOf dff/app/cordova/toughpadapi.ToughpadApiService
     * @function
     * @instance
     *
     * @returns {Promise} Promise that resolves when window.ToughpadApi is defined.
     */
    self.startService = function () {
        return new Promise(function (resolve, reject) {
            if (window.ToughpadApi) {
                window.ToughpadApi
                    .onBarcodeRead(function (msg) {
                        self.notifyBarcodeListener(msg);
                    }, function (reason) {
                        dffLoggingService.error(reason);
                    });

                resolve();
            }
            else {
                reject("ToughpadApi plugin not available");
            }
        });
    };

    return self;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="dff_app_cordova_common.PluginService.html">PluginService</a></li><li><a href="dff_app_cordova_toughpadapi.IncomingMessageLogger.html">IncomingMessageLogger</a></li><li><a href="dff_app_cordova_toughpadapi.ToughpadApiService.html">ToughpadApiService</a></li><li><a href="dff_app_cordova_wifi_manager.NetworkStateLogger.html">NetworkStateLogger</a></li><li><a href="dff_app_cordova_wifi_manager.ScanResultsLogger.html">ScanResultsLogger</a></li><li><a href="dff_app_cordova_wifi_manager.WifiMangerService.html">WifiMangerService</a></li><li><a href="dff_app_cordova_wifi_manager.WifiStateLogger.html">WifiStateLogger</a></li><li><a href="dff_app_log.LoggingStoreInterceptor.html">LoggingStoreInterceptor</a></li><li><a href="dff_app_packagepay.EndOfTour.html">EndOfTour</a></li><li><a href="dff_app_packagepay.IncomingMessageLogger.html">IncomingMessageLogger</a></li><li><a href="dff_app_packagepay.Logistician.html">Logistician</a></li><li><a href="dff_app_packagepay.Package.html">Package</a></li><li><a href="dff_app_packagepay.PackagepayService.html">PackagepayService</a></li><li><a href="dff_app_packagepay.Payment.html">Payment</a></li><li><a href="dff_app_packagepay.ServiceConnectionLogger.html">ServiceConnectionLogger</a></li><li><a href="dff_datetime.DateTimeService.html">DateTimeService</a></li><li><a href="dff_dom.MutationObserverService.html">MutationObserverService</a></li><li><a href="dff_gps_tools.ToolsService.html">ToolsService</a></li><li><a href="dff_idb.dff.idb.IDBError.html">IDBError</a></li><li><a href="dff_idb.ObjectStore.html">ObjectStore</a></li><li><a href="dff_iso_3166.CodeService.html">CodeService</a></li><li><a href="dff_log.LoggingService.html">LoggingService</a></li><li><a href="dff_log.Logline.html">Logline</a></li></ul><h3>Namespaces</h3><ul><li><a href="dff.html">dff</a></li><li><a href="dff_app_cordova_common.html">dff/app/cordova/common</a></li><li><a href="dff_app_cordova_toughpadapi.html">dff/app/cordova/toughpadapi</a></li><li><a href="dff_app_cordova_wifi_manager.html">dff/app/cordova/wifi/manager</a></li><li><a href="dff_app_log.html">dff/app/log</a></li><li><a href="dff_app_packagepay.html">dff/app/packagepay</a></li><li><a href="dff_datetime.html">dff/datetime</a></li><li><a href="dff_dom.html">dff/dom</a></li><li><a href="dff_gps_tools.html">dff/gps/tools</a></li><li><a href="dff_idb.html">dff/idb</a></li><li><a href="dff_iso_3166.html">dff/iso/3166</a></li><li><a href="dff_log.html">dff/log</a></li><li><a href="dff_util.html">dff/util</a></li><li><a href="dff_util_guid.html">dff/util/guid</a></li></ul><h3>Global</h3><ul><li><a href="global.html#dffIdbIndexedDBService">dffIdbIndexedDBService</a></li><li><a href="global.html">getObjectStore</a></li><li><a href="global.html#LOG">LOG</a></li><li><a href="global.html#MessageBoxSentShuttlesWorker">MessageBoxSentShuttlesWorker</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Tue Jul 05 2016 16:50:32 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
